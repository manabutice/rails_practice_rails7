# 現在のディレクトリ（カレントディレクトリ）を確認するコマンド
pwd

# Ruby3.2.2がインストールされたコンテナを起動してシェルを起動する

# Macの場合
docker run --rm -ti -v ./rails-practice:/app ruby:3.2.2-alpine sh
# Windowsの場合
docker run --rm -ti -v "$(pwd)/rails-practice:/app" ruby:3.2.2-alpine sh

# パッケージリストの更新
apk update

# Railsでアプリケーションを作成する際に必要なパッケージのインストール
apk add git g++ make mysql-dev

# RubyGemシステム（gemそのもの）のアップデート
gem update --system

# Railsのインストールバージョン指定
gem install rails -v 7.0.6

# プロジェクト作成
rails new /app --force --database=mysql --skip-bundle --skip-test



# docker-compose.ymlに定義したbuildの定義に基づいてDockerイメージをビルドするコマンド
docker compose build

# Dockerイメージのリストを表示するコマンド
docker image ls

# docker-compose.ymlに定義された内容に基づいて、コンテナを起動するコマンド

# フォアグランドで実行する場合
docker compose up

# バックグランドで実行する場合
docker compose up -d

# docker-compose.ymlで定義されたコンテナの状態を確認する際に使用するコマンド
docker compose ps

# docker-compose.ymlで定義されたコンテナを停止するコマンド
docker compose stop

# 特定のサービスのコンテナ上でコマンドを実行するコマンド
# 起動しているコンテナ上で実行される点に注意（停止している場合は実行に失敗します）
docker compose exec <サービス名> <コンテナ内で実行したいコマンド>

# 例: "web"サービスのコンテナ上でdbを作成するコマンドを実行する
docker compose exec web rails db:create


##### **docker compose**

docker-composeは、複数のDockerコンテナを定義、接続し、一緒に管理するためのツールです。

**`docker-compose.yml`**という設定ファイルに、サービス、ネットワーク、ボリュームなどの設定を記述することで、一つのコマンドで複数のコンテナの起動や停止を行うことができます。

特に、複数の関連するコンテナを持つアプリケーションのローカル開発やテストに便利です。

### **Docker Hub**

Docker Hubは、Dockerコンテナ用のイメージを公開、共有、検索するためのクラウドベースのサービスです。

Docker Hubを使用すると、ユーザーは自分のアプリケーションやサービスのDockerイメージを公開することができ、他のユーザーはそれらのイメージをダウンロードして利用することができます。

また、一般的によく使用されるソフトウェアやサービスは、公式にサポートされる「オフィシャルイメージ」としてDocker Hubに存在します。

これらのイメージは一般的に品質や安全性が高く、信頼して使用できます。

自身でDockerイメージを作成する際はこれらのイメージをベースに、用途に応じてカスタマイズして新たなイメージを作成します。

### **ボリューム（Docker）**

Dockerのボリュームは、コンテナのデータを持ち、永続的に保存するためのものです。

コンテナは通常、短命（一時的）で、停止または削除されるとその内部のデータも失われます。

しかし、ボリュームを使用すると、コンテナのライフサイクルとは独立してデータを保存・管理することができます。

ボリュームの主な特徴と用途:

1. **データ永続性**: コンテナが削除されても、ボリュームに保存されたデータは残ります。
2. **データ共有**: 複数のコンテナ間で同じボリュームをマウントして、データを共有することができます。
3. **ホストとのデータ共有**: ホストマシンの特定のディレクトリとコンテナのボリュームを連携させ、データを同期・共有することができます。

Dockerのボリュームはコンテナのデータを永続的に保存・管理するための仕組みであり、コンテナが短命である性質を補完する重要な機能です。

### **YAMLファイル**

YAML（"YAML Ain't Markup Language"とも言われる）は、データのシリアライズ形式の一つで、主に設定ファイルやデータ交換の目的で使用されます。

YAMLの主な特徴は、人間が読み書きしやすいプレーンテキスト形式であり、JSONやXMLよりもシンプルな構文を持っていることです。

インデントを利用してデータの階層構造を表現するため、構造が視覚的にわかりやすいのも特徴の一つです。

人間にとって読みやすく、書きやすいデータ形式を提供するテキストベースのフォーマットとなっています。

YAMLファイルには、`.yml`、または`.yaml`の拡張子が使用されます。

### **プロセス**

プロセスは、コンピュータ上で実行中のプログラムのインスタンスを指します。

Railsアプリケーションの実行も、１つのプロセスとして起動します（設定次第で複数のプロセスが起動します）。

それぞれのプロセスは独自のメモリ空間、状態、データなどを持ち、OSによって管理されます。

プロセスの停止（killとも言います）は、プロセスで実行しているプログラムの停止を意味します。

### **PID**

PID（Process ID）は、プロセス識別子のことを指します。

これは、OSが各プロセスを一意に識別するために使用する番号です。

PIDは通常、システム内の他のプロセスとは異なる一意の整数値として割り当てられます。

プロセスは実行中のプログラムで、PIDはそのプロセスを一意に識別する番号です。

### **IPアドレス**

WebアプリケーションにおけるIPアドレスは、特定のサーバー上のアプリケーションにアクセスするための「住所」のようなものです。

例えば、Webブラウザであるサイトを訪問するとき、そのサイトのサーバーのIPアドレスへとアクセスします。このIPアドレスを通じて、正しいサーバーとの通信が確立され、その結果としてWebページがブラウザに表示されます。

### **ポート**

Webアプリケーションは、特定の「ポート」と呼ばれる番号を使って通信を受け付けます。

PCで動作させる際のRails Serverではよく3000番ポートが使用されます。

ブラウザは通常、これらのポートを使用してWebサーバーに接続します。

ポートは、一つのサーバー内で複数のアプリケーションやサービスがそれぞれ異なる通信を行うための「入口」のような役割を果たします。

簡単に言うと、IPアドレスはWebアプリケーションがホストされている「ビル」を示し、ポートはそのビルの中の「ドア」を指定する番号のようなものと考えることができます。

### **依存関係（docker compose）**

**`docker-compose`**を使用して複数のコンテナを管理する際、特定のコンテナが他のコンテナに依存している場合があります。

例えば、Webアプリケーションのコンテナがデータベースのコンテナと通信する必要がある場合、Webアプリケーションのコンテナはデータベースのコンテナに依存していると言えます。

このような依存関係は、**`docker-compose.yml`**ファイルの中の**`depends_on`**オプションを使用して定義できます。

これにより、**`docker-compose`**はコンテナを正しい順序で起動・停止し、依存関係を考慮して動作します。

### **環境変数**

オペレーティングシステム上で動作するプログラムやアプリケーションが参照・利用する変数です。

これらの変数は、システムの動作やアプリケーションの設定を制御するための情報を持っています。

環境変数は通常、システムの起動時やアプリケーションの実行時に設定され、読み取りや変更が可能です。

### **Dockerイメージのビルド**

Dockerイメージのビルドは、特定のアプリケーションやサービスを実行するために必要なファイルや設定を含むイメージを作成するプロセスを指します。

このビルドのプロセスは、**`Dockerfile`**という指示書を基に行われます。

### **Dockerコンテナのフォアグラウンド実行とバックグラウンド実行**

Dockerコンテナを起動するとき、実行モードとして「フォアグラウンド」と「バックグラウンド」の2つの選択肢があります。

1. **フォアグラウンド実行**:
    - コンテナをフォアグラウンドモードで実行すると、コンテナのSTDOUT（標準出力）とSTDERR（標準エラー出力）が現在のシェルセッションに直接出力されます。
    - ターミナルやコマンドプロンプトを閉じる、またはコンテナプロセスを終了すると、コンテナも停止します。
    - 主に、コンテナ内のアクティビティをリアルタイムでモニタリングしたいときや、開発・デバッグの際に使用されます。
2. **バックグラウンド実行**:
    - コンテナをバックグラウンドモードで実行すると、コンテナはデーモンプロセスとしてバックグラウンドで動作します。これにより、ターミナルやシェルセッションを閉じてもコンテナは動作し続けます。
    - ユーザーはコンテナのログを**`docker logs`**コマンドで後から確認することができます。
    - 本番環境や、長時間実行させるサービスの起動時によく使用されます。

### **ログ**

ログは、ソフトウェアやシステムが実行中に発生するイベントやアクティビティの時系列的な記録です。

これらの記録は、問題の診断、監視、分析のために使用されることが多いです。

ログの主な特徴と用途:

1. **問題の診断**: システムやアプリケーションで問題が発生した場合、ログを確認することで何が起こったのか、どこで問題が発生したのかを判断する手助けとなります。
2. **監視**: 定期的にログをチェックすることで、システムの健全性や性能の問題、不正なアクセスなどを早期に検知することができます。
3. **履歴の保持**: 何が、いつ、どのように実行されたのかの記録を持つことで、後で分析のための参照情報として利用できます。

ログはシステムやアプリケーションの動作履歴を時系列で記録したものであり、トラブルシューティングや監視、分析のための重要なツールとして利用されます。

### **ソケットファイル**

ソケットファイルは、UnixおよびUnix系のシステムで使用される特殊なタイプのIPC（Inter-Process Communication、プロセス間通信）メカニズムの一部です。

ソケットファイルを介して、同じマシン上の異なるプロセス間でデータを送受信することができます。

例として、多くのシステムサービスやデーモン（MySQLなど）は、クライアントと通信するためのソケットファイルを持っています。これを使うことで、同じマシン上の他のプロセスが、TCP/IPネットワーク接続を使用せずに直接サービスやデーモンと通信できます。

ソケットファイルは、同じコンピュータ上の異なるプロセスが通信するための"ポイント"や"エンドポイント"として機能するファイルです。

### **本番環境**

ソフトウェアやシステムが実際のユーザーによって使用される環境を指します。

ここでの「実際のユーザー」とは、開発者やテスターではなく、エンドユーザー、つまりサービスの実際の顧客やクライアントのことを指します。

掲示板用のマイグレーションとモデルを作成するジェネレーターコマンド
$ docker compose run web rails g model board author_name:string title:string body:text

マイグレーションの実行コマンド
$ docker compose run web rails db:migrate

マイグレーションのロールバックコマンド
$ docker compose run web rails db:rollback

